{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <h3>{{ post.title }}</h3>
            <small>
                {{ post.author.nickname }},
                {{ post.created }} 작성,
                {{ post.modified }} 수정
            </small>
            <hr>
            <br>
            <div class="post-content">{{ post.content|linebreaks }}</div>
            <br>
            <div>
            {% if before_url %}
                <a href="{{ before_url }}" class='btn btn-secondary btn-sm'>글 목록</a>
            {% else %}
                <a href="{% url 'posts:post_list' %}" class='btn btn-secondary btn-sm'>글 목록</a>
            {% endif %}
            {% if user.is_authenticated %}
                <a href="{% url 'posts:post_edit' post.id %}" class='btn btn-secondary btn-sm'>수정</a>
                    {% if user.id == post.author.id %}
                        <form action="{% url 'posts:post_del' pk=post.pk %}" method="POST" class="del-form">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-secondary btn-sm">삭제</button>
                        </form>
            {% endif %}
            <form action="{% url 'posts:post_like'  pk=post.pk %}" method="POST" class="like-form">
                {% csrf_token %}
                {% if user in post.like_user.all %}
                    <button type="submit" class="btn btn-outline-primary btn-icon">
                        <i class="fas fa-thumbs-up" style="font-size:20px;"></i>
                    </button>
                {% else %}
                    <button type="submit" class="btn btn-outline-primary btn-icon">
                        <i class="far fa-thumbs-up" style="font-size:20px;"></i>
                    </button>
                {% endif %}
            </form>
            {% endif %}
            <span>{{ post.like_count }}</span>
            </div>
            <hr>
            {% if user.is_authenticated %}
            <form action="" method="POST">
                {% csrf_token %}
                    {{ form.content }}
                <input type="submit" class="btn btn-secondary btn-sm" value="댓글">
            </form>
            <hr>
            {% endif %}

                {% for comment in post.comment_set.all %}
            <div class="comment">
                <h5 class="comment-writer">{{ comment.author.nickname }}
                    <small> {{ comment.modified }}</small>
                </h5>
                <br>
                    {{ comment.content }}
                <br>
                <br>
                {% if user == post.author %}
                <form action=""
                      method="POST" class="comment-modify-form">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-secondary btn-sm">수정</button>
                </form>
                <form action="{% url 'posts:comment_del' comment.post.id comment.id %}"
                      method="POST" class="comment-del-form">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-secondary btn-sm">삭제</button>
                </form>
                {% endif %}
                <hr>
                </div>
                {% endfor %}
        </div>
    </div>
</div>
{% endblock %}